const pricingData={selectedRole:"Customer Service Representative",selectedTier:"enterprise",isVisible:false,isRoleDropdownOpen:false,isTierDropdownOpen:false,isMultiAgent:false,agentCount:1};const pricingElements={};document.addEventListener("DOMContentLoaded",function(){if(document.querySelector(".calculator-section")){initPricingCalculator()}});function initPricingCalculator(){cacheElements();if(pricingElements.section){initIntersectionObserver()}initDropdowns();initClickOutsideHandling();if(window.calculatorData&&window.calculatorData.defaults){pricingData.selectedRole=window.calculatorData.defaults.role;pricingData.selectedTier=window.calculatorData.defaults.tier;updateMultiAgentState()}updateCalculations()}function cacheElements(){pricingElements.section=document.querySelector(".calculator-section");pricingElements.wrapper=document.getElementById("calculator-wrapper");pricingElements.roleDropdown=document.getElementById("role-dropdown");pricingElements.roleDropdownTrigger=document.getElementById("role-dropdown-trigger");pricingElements.roleDropdownMenu=document.getElementById("role-dropdown-menu");pricingElements.roleLabel=document.getElementById("role-label");pricingElements.roleArrow=document.getElementById("role-arrow");pricingElements.roleOptions=Array.from(document.querySelectorAll("#role-dropdown-menu .dropdown-option"));pricingElements.tierDropdown=document.getElementById("tier-dropdown");pricingElements.tierDropdownTrigger=document.getElementById("tier-dropdown-trigger");pricingElements.tierDropdownMenu=document.getElementById("tier-dropdown-menu");pricingElements.tierLabel=document.getElementById("tier-label");pricingElements.tierArrow=document.getElementById("tier-arrow");pricingElements.tierOptions=Array.from(document.querySelectorAll("#tier-dropdown-menu .dropdown-option"));pricingElements.ukBaseSalary=document.getElementById("uk-base-salary");pricingElements.ukEmployerNi=document.getElementById("uk-employer-ni");pricingElements.ukPension=document.getElementById("uk-pension");pricingElements.ukHoliday=document.getElementById("uk-holiday");pricingElements.ukTraining=document.getElementById("uk-training");pricingElements.ukOffice=document.getElementById("uk-office");pricingElements.ukEquipment=document.getElementById("uk-equipment");pricingElements.ukInsurance=document.getElementById("uk-insurance");pricingElements.ukTotalCost=document.getElementById("uk-total-cost");pricingElements.ukSalaryLabel=document.getElementById("uk-salary-label");pricingElements.ukNiLabel=document.getElementById("uk-ni-label");pricingElements.ukPensionLabel=document.getElementById("uk-pension-label");pricingElements.ukHolidayLabel=document.getElementById("uk-holiday-label");pricingElements.ukTrainingLabel=document.getElementById("uk-training-label");pricingElements.ukOfficeLabel=document.getElementById("uk-office-label");pricingElements.ukEquipmentLabel=document.getElementById("uk-equipment-label");pricingElements.ukInsuranceLabel=document.getElementById("uk-insurance-label");pricingElements.ukTotalLabel=document.getElementById("uk-total-label");pricingElements.aetherbloomServiceFee=document.getElementById("aetherbloom-service-fee");pricingElements.aetherbloomTotalCost=document.getElementById("aetherbloom-total-cost");pricingElements.savingsAmount=document.getElementById("savings-amount");pricingElements.savingsPercentage=document.getElementById("savings-percentage")}function initIntersectionObserver(){const observerOptions={threshold:.1,rootMargin:"-50px 0px -50px 0px"};const observer=new IntersectionObserver(entries=>{entries.forEach(entry=>{pricingData.isVisible=entry.isIntersecting;updateSectionVisibility()})},observerOptions);observer.observe(pricingElements.section)}function updateSectionVisibility(){if(pricingElements.wrapper){if(pricingData.isVisible){pricingElements.wrapper.classList.add("visible")}else{pricingElements.wrapper.classList.remove("visible")}}}function initDropdowns(){let touchHandled=false;const handleDropdownToggle=toggleFn=>e=>{if(e.type==="touchend"){touchHandled=true;setTimeout(()=>{touchHandled=false},500)}else if(e.type==="click"&&touchHandled){return}e.preventDefault();e.stopPropagation();toggleFn()};if(pricingElements.roleDropdownTrigger){pricingElements.roleDropdownTrigger.addEventListener("click",handleDropdownToggle(toggleRoleDropdown));pricingElements.roleDropdownTrigger.addEventListener("touchend",handleDropdownToggle(toggleRoleDropdown))}pricingElements.roleOptions.forEach(option=>{const handleRoleOptionSelect=e=>{if(e.type==="touchend"){touchHandled=true;setTimeout(()=>{touchHandled=false},500)}else if(e.type==="click"&&touchHandled){return}e.preventDefault();e.stopPropagation();const roleName=e.currentTarget.dataset.role;selectRole(roleName);closeRoleDropdown()};option.addEventListener("click",handleRoleOptionSelect);option.addEventListener("touchend",handleRoleOptionSelect)});if(pricingElements.tierDropdownTrigger){pricingElements.tierDropdownTrigger.addEventListener("click",handleDropdownToggle(toggleTierDropdown));pricingElements.tierDropdownTrigger.addEventListener("touchend",handleDropdownToggle(toggleTierDropdown))}pricingElements.tierOptions.forEach(option=>{const handleTierOptionSelect=e=>{if(e.type==="touchend"){touchHandled=true;setTimeout(()=>{touchHandled=false},500)}else if(e.type==="click"&&touchHandled){return}e.preventDefault();e.stopPropagation();const tierId=e.currentTarget.dataset.tier;selectTier(tierId);closeTierDropdown()};option.addEventListener("click",handleTierOptionSelect);option.addEventListener("touchend",handleTierOptionSelect)})}function initClickOutsideHandling(){document.addEventListener("click",e=>{if(pricingElements.roleDropdown&&!pricingElements.roleDropdown.contains(e.target)){closeRoleDropdown()}if(pricingElements.tierDropdown&&!pricingElements.tierDropdown.contains(e.target)){closeTierDropdown()}})}function toggleRoleDropdown(){if(pricingData.isRoleDropdownOpen){closeRoleDropdown()}else{closeTierDropdown();openRoleDropdown()}}function openRoleDropdown(){pricingData.isRoleDropdownOpen=true;if(pricingElements.roleDropdownMenu){pricingElements.roleDropdownMenu.style.display="block";pricingElements.roleDropdownMenu.offsetHeight}if(pricingElements.roleArrow){pricingElements.roleArrow.classList.add("open")}if(pricingElements.roleDropdownTrigger){pricingElements.roleDropdownTrigger.setAttribute("aria-expanded","true")}}function closeRoleDropdown(){pricingData.isRoleDropdownOpen=false;if(pricingElements.roleDropdownMenu){pricingElements.roleDropdownMenu.style.display="none"}if(pricingElements.roleArrow){pricingElements.roleArrow.classList.remove("open")}if(pricingElements.roleDropdownTrigger){pricingElements.roleDropdownTrigger.setAttribute("aria-expanded","false")}}function toggleTierDropdown(){if(pricingData.isTierDropdownOpen){closeTierDropdown()}else{closeRoleDropdown();openTierDropdown()}}function openTierDropdown(){pricingData.isTierDropdownOpen=true;if(pricingElements.tierDropdownMenu){pricingElements.tierDropdownMenu.style.display="block";pricingElements.tierDropdownMenu.offsetHeight}if(pricingElements.tierArrow){pricingElements.tierArrow.classList.add("open")}if(pricingElements.tierDropdownTrigger){pricingElements.tierDropdownTrigger.setAttribute("aria-expanded","true")}}function closeTierDropdown(){pricingData.isTierDropdownOpen=false;if(pricingElements.tierDropdownMenu){pricingElements.tierDropdownMenu.style.display="none"}if(pricingElements.tierArrow){pricingElements.tierArrow.classList.remove("open")}if(pricingElements.tierDropdownTrigger){pricingElements.tierDropdownTrigger.setAttribute("aria-expanded","false")}}function selectRole(roleName){if(!roleName)return;pricingData.selectedRole=roleName;if(pricingElements.roleLabel){pricingElements.roleLabel.textContent=roleName}pricingElements.roleOptions.forEach(option=>{if(option.dataset.role===roleName){option.classList.add("selected")}else{option.classList.remove("selected")}});const roleTierLinks={"Admin Assistant":"growth","Customer Service Representative":"enterprise","Sales Support Coordinator":"engagement"};if(roleTierLinks[roleName]){selectTier(roleTierLinks[roleName])}else{updateCalculations()}}function selectTier(tierId){if(!tierId)return;pricingData.selectedTier=tierId;updateMultiAgentState();const tierData=getTierData(tierId);if(tierData&&pricingElements.tierLabel){pricingElements.tierLabel.textContent=tierData.name}pricingElements.tierOptions.forEach(option=>{if(option.dataset.tier===tierId){option.classList.add("selected")}else{option.classList.remove("selected")}});updateCalculations()}function updateMultiAgentState(){const tierData=getTierData(pricingData.selectedTier);if(tierData){pricingData.isMultiAgent=tierData.is_multi_agent||false;pricingData.agentCount=tierData.agent_count||1;updateUKLabels()}}function updateUKLabels(){const multiplier=pricingData.isMultiAgent?`${pricingData.agentCount}x `:"";const suffix=pricingData.isMultiAgent?` (${pricingData.agentCount} positions)`:"";if(pricingElements.ukSalaryLabel){pricingElements.ukSalaryLabel.textContent=`${multiplier}Base salary`}if(pricingElements.ukNiLabel){pricingElements.ukNiLabel.textContent=`${multiplier}Employer NI`}if(pricingElements.ukPensionLabel){pricingElements.ukPensionLabel.textContent=`${multiplier}Pension`}if(pricingElements.ukHolidayLabel){pricingElements.ukHolidayLabel.textContent=`${multiplier}Holiday pay`}if(pricingElements.ukTrainingLabel){pricingElements.ukTrainingLabel.textContent=`${multiplier}Training`}if(pricingElements.ukOfficeLabel){pricingElements.ukOfficeLabel.textContent=`${multiplier}Office space`}if(pricingElements.ukEquipmentLabel){pricingElements.ukEquipmentLabel.textContent=`${multiplier}Equipment`}if(pricingElements.ukInsuranceLabel){pricingElements.ukInsuranceLabel.textContent=`${multiplier}Insurance`}if(pricingElements.ukTotalLabel){pricingElements.ukTotalLabel.textContent=`Total annual cost${suffix}`}}function getRoleData(roleName){if(!window.calculatorData||!window.calculatorData.roles){return null}return window.calculatorData.roles.find(role=>role.name===roleName)}function getTierData(tierId){if(!window.calculatorData||!window.calculatorData.tiers){return null}return window.calculatorData.tiers.find(tier=>tier.id===tierId)}function calculateUKCosts(baseSalary,multiplier=1){const adjustedSalary=baseSalary*multiplier;const employerNI=Math.round(adjustedSalary*.138*multiplier);const pension=Math.round(adjustedSalary*.03*multiplier);const holidayPay=Math.round(adjustedSalary*.077*multiplier);const training=1500*multiplier;const officeSpace=4800*multiplier;const equipment=800*multiplier;const insurance=534*multiplier;return{baseSalary:adjustedSalary,employerNI:employerNI,pension:pension,holidayPay:holidayPay,training:training,officeSpace:officeSpace,equipment:equipment,insurance:insurance,total:adjustedSalary+employerNI+pension+holidayPay+training+officeSpace+equipment+insurance}}function updateCalculations(){const roleData=getRoleData(pricingData.selectedRole);const tierData=getTierData(pricingData.selectedTier);if(!roleData||!tierData){console.warn("Missing role or tier data");return}const multiplier=pricingData.isMultiAgent?pricingData.agentCount:1;const ukCosts=calculateUKCosts(roleData.salary,multiplier);const aetherbloomCost=tierData.cost;updateElement(pricingElements.ukBaseSalary,formatCurrency(ukCosts.baseSalary));updateElement(pricingElements.ukEmployerNi,formatCurrency(ukCosts.employerNI));updateElement(pricingElements.ukPension,formatCurrency(ukCosts.pension));updateElement(pricingElements.ukHoliday,formatCurrency(ukCosts.holidayPay));updateElement(pricingElements.ukTraining,formatCurrency(ukCosts.training));updateElement(pricingElements.ukOffice,formatCurrency(ukCosts.officeSpace));updateElement(pricingElements.ukEquipment,formatCurrency(ukCosts.equipment));updateElement(pricingElements.ukInsurance,formatCurrency(ukCosts.insurance));updateElement(pricingElements.ukTotalCost,formatCurrency(ukCosts.total));updateElement(pricingElements.aetherbloomServiceFee,formatCurrency(aetherbloomCost));updateElement(pricingElements.aetherbloomTotalCost,formatCurrency(aetherbloomCost));const savings=ukCosts.total-aetherbloomCost;const savingsPercentage=Math.round(savings/ukCosts.total*100);updateElement(pricingElements.savingsAmount,formatCurrency(savings));updateElement(pricingElements.savingsPercentage,`${savingsPercentage}%`)}function updateElement(element,text){if(element){element.textContent=text}}function formatCurrency(amount){return`£${amount.toLocaleString()}`}